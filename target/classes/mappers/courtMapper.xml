<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.kosta.matchmaker.mappers.CourtMapper">

	<!-- 코트 목록 조회 -->
	<select id="getCourts" resultType="CourtVO">
		select a.title, a.replycnt, c.lat, c.lng, c.liked, c.cno 
		from court c natural join article a 
		where c.approval = 'Y'
		order by c.cno desc 
		limit #{pageidx}, 10
	</select>
	
	<!-- 코트 검색 목록 조회 -->
	<select id="getSearchCourts" resultType="CourtVO">
		select a.title, a.replycnt, c.lat, c.lng, c.liked, c.cno 
		from court c natural join article a 
		where c.approval = 'Y' and c.lat between #{swlat} and #{nelat} and c.lng between #{swlng} and #{nelng}
		order by c.cno desc 
		limit #{pageidx}, 10
	</select>

	<!-- 코트 1개 조회 -->
	<select id="getCourt" resultType="CourtVO">
		select * from court natural join article where approval = 'Y' and cno = #{cno}
	</select>

	<!-- 코트 등록 -->
	<insert id="regCourt">
		insert into court(bno, ano, address, lat, lng, approval)
		values(#{bno}, #{ano}, #{address}, #{lat}, #{lng}) 
	</insert>

	<!-- 코트 좋아요 올리기 -->
	<update id="likeCourt">
		update court set liked = liked + 1 where cno = #{cno}
	</update>


	<!-- 게임 목록 조회 -->
	<select id="getMatches" resultType="MatchDTO">
		select mno, mname, 
		DATE_FORMAT(begintime, '%m/%d %h:%i %p') begintime, 
		DATE_FORMAT(endtime, '%m/%d %h:%i %p') endtime,
		cno, state from match_court
	</select>
	
	
	
	
	
	
	<!-- <![CDATA[
 		select a.bno, a.ano, a.title, a.writer, a.content, a.regdate, a.hit, a.replycnt
 		from article a
 		where a.bno = #{bno} and not article_type = 'N'
 		]]>
	
	
	<![CDATA[	
		order by a.ano desc
		limit #{cri.pageStart} , #{cri.perPageNum}
		]]>
	
	
	동적 SQL을 위한 부분 SQL
	<sql id="search">
		<if test="searchType != null">
			<if test="searchType == 't'.toString()">
				and title like CONCAT('%', #{cri.keyword}, '%')
			</if>
			<if test="searchType == 'c'.toString()">
				and content like CONCAT('%', #{cri.keyword}, '%')
			</if>
			<if test="searchType == 'w'.toString()">
				and writer like CONCAT('%', #{cri.keyword}, '%')
			</if>
			<if test="searchType == 'tc'.toString()">
				and ( title like CONCAT('%', #{cri.keyword}, '%') OR content
				like
				CONCAT('%', #{cri.keyword}, '%'))
			</if>
			<if test="searchType == 'cw'.toString()">
				and ( content like CONCAT('%', #{cri.keyword}, '%') OR writer
				like
				CONCAT('%', #{cri.keyword}, '%'))
			</if>
			<if test="searchType == 'tcw'.toString()">
				and ( title like CONCAT('%', #{cri.keyword}, '%')
				OR
				content
				like CONCAT('%', #{cri.keyword}, '%')
				OR
				writer like CONCAT('%',
				#{cri.keyword}, '%'))
			</if>
		</if>
	</sql> -->
	
	
	
</mapper>